<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug LiveKit Loading</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #000; color: #0f0; padding: 10px; height: 400px; overflow-y: scroll; font-family: monospace; }
        .error { color: #f00; }
        .success { color: #0f0; }
    </style>
</head>
<body>
    <h1>LiveKit Debug</h1>
    <div id="log" class="log"></div>
    <button onclick="testCDN()">Test CDN</button>
    <button onclick="testLocal()">Test Local</button>
    <button onclick="clearLog()">Clear</button>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testCDN() {
            log('Testing CDN LiveKit...');
            try {
                const response = await fetch('https://unpkg.com/livekit-client@2.15.8/dist/livekit-client.umd.js', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                log('CDN HEAD request completed', 'success');
                
                // Try to load the script
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/livekit-client@2.15.8/dist/livekit-client.umd.js';
                script.onload = () => {
                    log('CDN script loaded successfully', 'success');
                    log('LiveKit object: ' + (typeof LiveKit !== 'undefined' ? 'available' : 'undefined'));
                    if (typeof LiveKit !== 'undefined') {
                        log('LiveKit.Room: ' + (typeof LiveKit.Room !== 'undefined' ? 'available' : 'undefined'));
                    }
                };
                script.onerror = (e) => {
                    log('CDN script failed to load: ' + e, 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                log('CDN test failed: ' + error.message, 'error');
            }
        }

        async function testLocal() {
            log('Testing local LiveKit...');
            try {
                const response = await fetch('/livekit-client.umd.js', {
                    method: 'HEAD'
                });
                log('Local file accessible: ' + response.status, response.ok ? 'success' : 'error');
                
                // Try to load the script
                const script = document.createElement('script');
                script.src = '/livekit-client.umd.js';
                script.onload = () => {
                    log('Local script loaded successfully', 'success');
                    log('LiveKit object: ' + (typeof LiveKit !== 'undefined' ? 'available' : 'undefined'));
                    if (typeof LiveKit !== 'undefined') {
                        log('LiveKit.Room: ' + (typeof LiveKit.Room !== 'undefined' ? 'available' : 'undefined'));
                    }
                };
                script.onerror = (e) => {
                    log('Local script failed to load: ' + e, 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                log('Local test failed: ' + error.message, 'error');
            }
        }

        // Test both on load
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, starting tests...');
            setTimeout(() => {
                testLocal();
            }, 1000);
            setTimeout(() => {
                testCDN();
            }, 2000);
        });
    </script>
</body>
</html>
