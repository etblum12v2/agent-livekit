<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple LiveKit Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #000; color: #0f0; padding: 10px; height: 400px; overflow-y: scroll; font-family: monospace; }
        .error { color: #f00; }
        .success { color: #0f0; }
    </style>
</head>
<body>
    <h1>Simple LiveKit Test</h1>
    <div id="log" class="log"></div>
    <button onclick="testLiveKit()">Test LiveKit</button>
    <button onclick="clearLog()">Clear</button>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testLiveKit() {
            log('Testing LiveKit availability...');
            log('window.LiveKit: ' + typeof window.LiveKit);
            log('window.LivekitClient: ' + typeof window.LivekitClient);
            log('globalThis.LiveKit: ' + typeof globalThis.LiveKit);
            log('LiveKit: ' + typeof LiveKit);
            
            // Check for LivekitClient (correct global name)
            if (typeof window.LivekitClient !== 'undefined') {
                log('LivekitClient found on window!', 'success');
                log('LivekitClient.Room: ' + typeof window.LivekitClient.Room);
                if (typeof window.LivekitClient.Room === 'function') {
                    log('LivekitClient.Room is a function - SUCCESS!', 'success');
                } else {
                    log('LivekitClient.Room is not a function', 'error');
                }
                
                // Expose as LiveKit for compatibility
                window.LiveKit = window.LivekitClient;
                globalThis.LiveKit = window.LivekitClient;
                log('Exposed LivekitClient as LiveKit for compatibility', 'success');
            } else if (typeof window.LiveKit !== 'undefined') {
                log('LiveKit found on window!', 'success');
                log('LiveKit.Room: ' + typeof window.LiveKit.Room);
                if (typeof window.LiveKit.Room === 'function') {
                    log('LiveKit.Room is a function - SUCCESS!', 'success');
                } else {
                    log('LiveKit.Room is not a function', 'error');
                }
            } else {
                log('LiveKit not found on window', 'error');
            }
            
            // Check for other possible locations
            for (let key in window) {
                if (key.toLowerCase().includes('livekit')) {
                    log(`Found LiveKit-related property: ${key}`, 'success');
                    if (typeof window[key] === 'object' && window[key]) {
                        log(`  - ${key} has Room: ` + typeof window[key].Room);
                        log(`  - ${key} has connect: ` + typeof window[key].connect);
                    }
                }
            }
        }

        // Load LiveKit script directly
        function loadLiveKit() {
            log('Loading LiveKit script...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/livekit-client@2.15.8/dist/livekit-client.umd.js';
            script.onload = function() {
                log('LiveKit script loaded successfully', 'success');
                setTimeout(() => {
                    log('Checking for LiveKit after load...');
                    testLiveKit();
                }, 100);
            };
            script.onerror = function() {
                log('Failed to load LiveKit script', 'error');
            };
            document.head.appendChild(script);
        }

        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, starting LiveKit test...');
            loadLiveKit();
        });
    </script>
</body>
</html>
